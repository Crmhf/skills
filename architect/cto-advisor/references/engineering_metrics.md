# 工程指标体系

建立数据驱动的工程效能度量体系。

---

## 1. 为什么度量工程效能

### 目标
- 识别流程瓶颈
- 持续改进依据
- 资源优化配置
- 团队健康监测

### 反模式
- ❌ 用代码行数衡量产出
- ❌ 用工作时长衡量投入
- ❌ 仅关注速度，忽视质量
- ❌ 指标用于考核而非改进

---

## 2. DORA 核心指标

### 四大指标详解

```
┌────────────────────────────────────────────────────────────┐
│                      DORA 框架                              │
├──────────────────────┬─────────────────────────────────────┤
│  部署频率             │  变更前置时间                        │
│  (Deployment         │  (Lead Time for                     │
│   Frequency)         │   Changes)                          │
│                      │                                     │
│  多久部署一次生产？    │  代码提交到上线需要多久？             │
├──────────────────────┼─────────────────────────────────────┤
│  变更失败率           │  服务恢复时间                        │
│  (Change             │  (Time to Restore                   │
│   Failure Rate)      │   Service)                          │
│                      │                                     │
│  多少部署导致故障？    │  故障发生后多久恢复？                │
└──────────────────────┴─────────────────────────────────────┘
```

### 性能等级

| 指标 | 精英级 | 高绩效 | 中等 | 低绩效 |
|-----|-------|--------|------|--------|
| **部署频率** | 按需/每天多次 | 每天一次-每周一次 | 每周一次-每月一次 | 少于每月一次 |
| **变更前置时间** | < 1小时 | < 1周 | 1周-1月 | > 1月 |
| **变更失败率** | < 5% | 5%-15% | 16%-30% | > 30% |
| **服务恢复时间** | < 1小时 | < 1天 | 1天-1周 | > 1周 |

### 指标计算方法

**部署频率**
```
部署频率 = 统计周期内生产部署次数 / 统计天数

示例: 2周内部署 10 次
部署频率 = 10 / 14 = 0.71 次/天 ≈ 每天 1 次
等级: 高绩效
```

**变更前置时间**
```
前置时间 = Σ(部署时间 - 首次代码提交时间) / 部署次数

示例:
- PR #1: 提交 1/1, 部署 1/3 → 2 天
- PR #2: 提交 1/2, 部署 1/4 → 2 天
- PR #3: 提交 1/5, 部署 1/5 → 0 天
平均前置时间 = (2 + 2 + 0) / 3 = 1.33 天
等级: 高绩效
```

**变更失败率**
```
失败率 = 导致事故或回滚的部署次数 / 总部署次数 × 100%

示例:
- 总部署: 20 次
- 失败部署: 2 次 (1次回滚，1次热修复)
失败率 = 2 / 20 × 100% = 10%
等级: 高绩效
```

**服务恢复时间**
```
恢复时间 = Σ(服务恢复时间 - 故障发生时间) / 故障次数

示例:
- 故障1: 10:00 发生，11:30 恢复 → 90 分钟
- 故障2: 14:00 发生，14:45 恢复 → 45 分钟
平均恢复时间 = (90 + 45) / 2 = 67.5 分钟
等级: 精英级
```

---

## 3. 扩展指标框架

### SPACE 框架

```
┌─────────────────────────────────────────────────────┐
│                  SPACE 框架                          │
├─────────────────────────────────────────────────────┤
│  S - Satisfaction and Well-being（满意度与幸福感）   │
│  P - Performance（绩效）                            │
│  A - Activity（活跃度）                             │
│  C - Communication and Collaboration（沟通与协作）   │
│  E - Efficiency and Flow（效率与流动）               │
└─────────────────────────────────────────────────────┘
```

**满意度指标**
| 指标 | 定义 | 测量方式 |
|-----|------|---------|
| 开发者满意度 | 对工具/流程的满意程度 | 季度调查（1-10分） |
| 团队健康度 | 团队氛围和协作质量 | 匿名问卷 |
| 留存率 | 核心人才保留比例 | 年度统计 |

**绩效指标**
| 指标 | 定义 | 目标值 |
|-----|------|-------|
| 需求交付率 | 承诺交付/实际交付 | > 80% |
| 缺陷逃逸率 | 生产缺陷/总缺陷 | < 10% |
| 系统可用性 | 1 - 停机时间/总时间 | > 99.9% |

**活跃度指标**
| 指标 | 定义 | 说明 |
|-----|------|------|
| 代码提交频率 | 人均每日提交次数 | 关注趋势而非绝对值 |
| PR 数量 | 每周创建的 PR 数 | 反映开发活跃度 |
| 构建次数 | 每日 CI 构建次数 | 反映自动化程度 |

**协作指标**
| 指标 | 定义 | 目标值 |
|-----|------|-------|
| 代码审查参与率 | 参与审查人数/团队人数 | > 70% |
| 跨团队依赖数 | 团队间阻塞性依赖 | 持续降低 |
| 知识分享次数 | 技术分享/文档更新 | 每周 > 1 |

**效率指标**
| 指标 | 定义 | 目标值 |
|-----|------|-------|
| 构建时间 | CI 构建平均时长 | < 10 分钟 |
| PR 合并时间 | 从创建到合并 | < 4 小时 |
| 环境准备时间 | 新人搭建开发环境 | < 1 天 |

---

## 4. 指标仪表板设计

### 分层视图

**执行层仪表板**
```
┌─────────────────────────────────────────────────────────────┐
│  执行层视图 (CTO/VP)                                        │
├─────────────────────────────────────────────────────────────┤
│  DORA 指标趋势          团队健康度          业务价值交付     │
│  ┌─────────┐           ┌─────────┐         ┌─────────┐     │
│  │ 部署频率 │           │ 满意度  │         │ 需求吞吐 │     │
│  │   ↑     │           │   8.5   │         │   ↑     │     │
│  └─────────┘           └─────────┘         └─────────┘     │
│                                                             │
│  重点关注: 趋势而非绝对值，跨团队对比                       │
└─────────────────────────────────────────────────────────────┘
```

**管理层仪表板**
```
┌─────────────────────────────────────────────────────────────┐
│  管理层视图 (Director/Manager)                              │
├─────────────────────────────────────────────────────────────┤
│  团队效率              代码质量              流程健康        │
│  ┌─────────┐          ┌─────────┐          ┌─────────┐     │
│  │前置时间 │          │测试覆盖 │          │审查延迟 │     │
│  │  2.5天  │          │  78%   │          │  3小时  │     │
│  └─────────┘          └─────────┘          └─────────┘     │
│                                                             │
│  重点关注: 瓶颈识别，改进措施跟踪                           │
└─────────────────────────────────────────────────────────────┘
```

**团队层仪表板**
```
┌─────────────────────────────────────────────────────────────┐
│  团队视图 (Tech Lead/开发者)                                │
├─────────────────────────────────────────────────────────────┤
│  我的工作              待办事项              团队目标        │
│  ┌─────────┐          ┌─────────┐          ┌─────────┐     │
│  │待审查PR │          │阻塞事项 │          │本周目标 │     │
│  │   3     │          │   1     │          │ 80%完成 │     │
│  └─────────┘          └─────────┘          └─────────┘     │
│                                                             │
│  重点关注: 个人效率，协作状态                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 指标实施路线图

### 阶段1: 基础设施（1-2月）
- [ ] 接入代码仓库（GitHub/GitLab）
- [ ] 接入 CI/CD 系统
- [ ] 接入工单系统（Jira/Linear）
- [ ] 搭建指标收集管道

### 阶段2: 核心指标（3-4月）
- [ ] 部署频率自动化统计
- [ ] 前置时间跟踪
- [ ] 构建时间监控
- [ ] 基础仪表板上线

### 阶段3: 扩展指标（5-6月）
- [ ] 代码质量指标（SonarQube 集成）
- [ ] 代码审查指标
- [ ] 团队满意度调查
- [ ] 高级分析功能

### 阶段4: 持续优化（持续）
- [ ] 指标基线建立
- [ ] 目标设定与跟踪
- [ ] 异常自动告警
- [ ] 预测性分析

---

## 6. 指标工具对比

| 工具 | 类型 | DORA | 优点 | 缺点 | 价格 |
|-----|------|------|------|------|------|
| Sleuth | SaaS | ✅ | 易用，集成好 | 功能较单一 | $$ |
| Faros | SaaS | ✅ | 开源可选 | 学习曲线 | $-$$$ |
| LinearB | SaaS | ✅ | 功能全面 | 价格较高 | $$$ |
| Grafana | 开源 | 需自建 | 灵活定制 | 需投入开发 | 免费 |
| Allstacks | SaaS | ✅ | 企业级 | 仅企业版 | $$$ |

---

## 7. 反模式与注意事项

### ❌ 常见错误

1. **指标驱动不良行为**
   - 问题: 追求高提交数 → 无意义的小提交
   - 解决: 多指标组合，关注价值交付

2. **过度度量**
   - 问题: 跟踪过多指标，失去焦点
   - 解决: 聚焦 3-5 个核心指标

3. **忽视质量追求速度**
   - 问题: 只看部署频率，忽视失败率
   - 解决: DORA 四个指标一起看

4. **指标用于考核**
   - 问题: 指标与个人绩效挂钩
   - 解决: 指标用于团队改进，不用于个人评价

5. **缺乏上下文**
   - 问题: 只看数字，不了解原因
   - 解决: 定性调研 + 定量数据

### ✅ 最佳实践

- 指标是改进的起点，不是终点
- 定期回顾指标有效性
- 结合定性反馈理解数据
- 公开透明地分享指标
- 庆祝进步，不苛责完美
